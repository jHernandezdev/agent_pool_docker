trigger:
  branches:
   include:     
     - main
  paths:
    include:
    - dockeragent

stages:
  - stage: CI
    displayname: Build-Push de la imagen
    jobs:
    - job: Docker
      displayname: Build and push image
      pool: 
        vmImage: ubuntu-latest
      steps:
        - task: Docker@2
          displayName: Build image
          inputs:
            command: build
            containerRegistry: 'jmhhcontainerregistry'
            repository: 'linux-agents'
            Dockerfile: 'dockeragent/Dockerfile'
            buildContext: 'dockeragent/'
            tags: |
              $(Build.BuildId)
              latest
              
        - task: Docker@2
          displayName: Push image
          inputs:
            containerRegistry: 'jmhhcontainerregistry'
            repository: 'linux-agents'
            command: push
            tags: |
              $(Build.BuildId)
              latest  